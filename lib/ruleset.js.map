{"version":3,"sources":["../src/ruleset.js"],"names":[],"mappings":"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","file":"ruleset.js","sourcesContent":["const VALID_KO_OPTIONS = [\n  \"simple\",\n  \"superko\"\n];\n\nconst Ruleset = function({ koRule }) {\n  this.koRule = koRule;\n\n  if (VALID_KO_OPTIONS.indexOf(this.koRule) < 0) {\n    throw new Error(\"Unknown ko rule: \" + koRule);\n  }\n\n  Object.freeze(this);\n};\n\nRuleset.prototype = {\n  isIllegal: function(y, x, game) {\n    const boardState = game.currentState();\n    const nextColor = game.currentPlayer();\n    const intersection = boardState.intersectionAt(y, x);\n\n    const result = !intersection.isEmpty() ||\n      this._wouldBeSuicide(y, x, nextColor, boardState) ||\n      this._isKoViolation(y, x, nextColor, boardState, game._moves);\n\n    return result;\n  },\n\n  _isKoViolation: function(y, x, color, boardState, existingStates) {\n    let isKoViolation = false;\n\n    if (this.koRule === \"simple\") {\n      const koPoint = boardState.koPoint;\n      isKoViolation = koPoint && koPoint.y === y && koPoint.x === x;\n    } else {\n      const newState = boardState.playAt(y, x, color);\n      const boardStates = existingStates;\n\n      isKoViolation = existingStates.length > 0 && boardStates.some(existingState => {\n        return existingState.positionSameAs(newState);\n      });\n    }\n\n    return isKoViolation;\n  },\n\n  _wouldBeSuicide: function(y, x, color, boardState) {\n    const intersection = boardState.intersectionAt(y, x);\n    const surroundedEmptyPoint = intersection.isEmpty() && boardState.neighborsFor(intersection.y, intersection.x).filter(neighbor => neighbor.isEmpty()).length === 0;\n\n    if (!surroundedEmptyPoint) {\n      return false;\n    }\n\n    const someFriendlyNotInAtari = boardState.neighborsFor(intersection.y, intersection.x).some(neighbor => {\n      const inAtari = boardState.inAtari(neighbor.y, neighbor.x);\n      const friendly = neighbor.isOccupiedWith(color);\n\n      return friendly && !inAtari;\n    });\n\n    if (someFriendlyNotInAtari) {\n      return false;\n    }\n\n    const someEnemyInAtari = boardState.neighborsFor(intersection.y, intersection.x).some(neighbor => {\n      const inAtari = boardState.inAtari(neighbor.y, neighbor.x);\n      const enemy = !neighbor.isOccupiedWith(color);\n\n      return enemy && inAtari;\n    });\n\n    if (someEnemyInAtari) {\n      return false;\n    }\n\n    return true;\n  }\n};\n\nexport default Ruleset;\n"]}